#!/bin/bash

cd ${1:-.}

while IFS= read -r row; do
	rm -rf "/service/uploads/$row"
done < <(sqlite3 db.sqlite "SELECT dir FROM users WHERE creat < strftime('%s', 'now') - 780")

while IFS= read -r row; do
	rm -rf "/service/reports/$row"
done < <(sqlite3 db.sqlite3 "SELECT file FROM reports WHERE creat < strftime('%s', 'now') - 780")

sqlite3 db.sqlite "DELETE FROM users WHERE creat < strftime('%s', 'now') - 780"

